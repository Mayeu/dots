#!/usr/bin/env bash

cd ~/.dots

echo "â† Update flake"
nix flake update

# Nix don't update brew as far as I understand
echo "ğŸº Updating brew"
brew update

## 2021-04-18 TODO: Only path the specific variable nix & nix-darwin needs
echo "ğŸ‘¹ Updating nix-darwin"
m switch

echo "ğŸº Cleanup brew cache"
brew cleanup --prune 14

echo "ğŸ‘¹ Collect nix garbage"
sudo nix-collect-garbage --delete-older-than 14d

echo "ğŸ‘¹ Dedup nix store"
sudo nix store optimise

# Make sure dvp is my login keyboard
echo "âŒ¨ï¸  Update my login keyboard"
sudo cp ~/Library/Preferences/com.apple.HIToolbox.plist /Library/Preferences/
sudo chmod 644 /Library/Preferences/com.apple.HIToolbox.plist
